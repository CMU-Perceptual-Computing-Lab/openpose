<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenPose: OpenPose Advanced Doc - Heatmap Output</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo_doxygen_black.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenPose
   &#160;<span id="projectnumber">1.7.0</span>
   </div>
   <div id="projectbrief">The first real-time multi-person system to jointly detect human body, hand, facial, and foot keypoints</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doc_advanced_heatmap_output.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OpenPose Advanced Doc - Heatmap Output </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md159"></a>
Contents</h1>
<ol type="1">
<li><a href="#keypoints">Keypoints</a></li>
<li><a href="#ui-and-visual-heatmap-output">UI and Visual Heatmap Output</a></li>
<li><a href="#heatmap-ordering">Heatmap Ordering</a></li>
<li><a href="#heatmap-saving-in-float-format">Heatmap Saving in Float Format</a></li>
<li><a href="#heatmap-scaling">Heatmap Scaling</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md160"></a>
Keypoints</h1>
<p>Check <a class="el" href="md_doc_02_output.html">doc/output_keypoints.md</a> for the basic output information. This document is for users that want to use the heatmaps.</p>
<h1><a class="anchor" id="autotoc_md161"></a>
UI and Visual Heatmap Output</h1>
<p align="center">If you choose to visualize a body part or a PAF (Part Affinity Field) heat map with the command option <code>--part_to_show</code>, the visual GUI should show something similar to one of the following images: </p>
<p><img src="../.github/media/body_heat_maps.png" alt="" width="720" class="inline"/> </p>
<p><img src="../.github/media/paf_heat_maps.png" alt="" width="720" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md162"></a>
Heatmap Ordering</h1>
<p>For the <b>heat maps storing format</b>, instead of saving each of the 67 heatmaps (18 body parts + background + 2 x 19 PAFs) individually, the library concatenates them into a huge (width x #heat maps) x (height) matrix (i.e., concatenated by columns). E.g., columns [0, individual heat map width] contain the first heat map, columns [individual heat map width + 1, 2 * individual heat map width] contain the second heat map, etc. Note that some image viewers are not able to display the resulting images due to the size. However, Chrome and Firefox are able to properly open them.</p>
<p>The saving order is body parts + background + PAFs. Any of them can be disabled with program flags. If background is disabled, then the final image will be body parts + PAFs. The body parts and background follow the order of <code>getPoseBodyPartMapping(const PoseModel poseModel)</code>.</p>
<p>The PAFs follow the order specified on <code>getPosePartPairs(const PoseModel poseModel)</code> together with <code>getPoseMapIndex(const PoseModel poseModel)</code>. E.g., assuming COCO (see example code below), the PAF channels in COCO start in 19 (smallest number in <code>getPoseMapIndex</code>, equal to #body parts + 1), and end up in 56 (highest one). Then, we can match its value from <code>getPosePartPairs</code>. For instance, 19 (x-channel) and 20 (y-channel) in <code>getPoseMapIndex</code> correspond to PAF from body part 1 to 8; 21 and 22 correspond to x,y channels in the joint from body part 8 to 9, etc. Note that if the smallest channel is odd (19), then all the x-channels are odd, and all the y-channels even. If the smallest channel is even, then the opposite will happen. </p><div class="fragment"><div class="line">// C++ API call</div>
<div class="line">#include &lt;openpose/pose/poseParameters.hpp&gt;</div>
<div class="line">const auto&amp; posePartPairsBody25 = getPosePartPairs(PoseModel::BODY_25);</div>
<div class="line">const auto&amp; posePartPairsCoco = getPosePartPairs(PoseModel::COCO_18);</div>
<div class="line">const auto&amp; posePartPairsMpi = getPosePartPairs(PoseModel::MPI_15);</div>
<div class="line"> </div>
<div class="line">// getPosePartPairs(PoseModel::BODY_25) result</div>
<div class="line">// Each index is the key value corresponding to each body part in `getPoseBodyPartMapping`. E.g., 1 for &quot;Neck&quot;, 2 for &quot;RShoulder&quot;, etc.</div>
<div class="line">// 1,8,   1,2,   1,5,   2,3,   3,4,   5,6,   6,7,   8,9,   9,10,  10,11, 8,12,  12,13, 13,14,  1,0,   0,15, 15,17,  0,16, 16,18,   2,17,  5,18,   14,19,19,20,14,21, 11,22,22,23,11,24</div>
<div class="line"> </div>
<div class="line">// getPoseMapIndex(PoseModel::BODY_25) result</div>
<div class="line">// 0,1, 14,15, 22,23, 16,17, 18,19, 24,25, 26,27, 6,7, 2,3, 4,5, 8,9, 10,11, 12,13, 30,31, 32,33, 36,37, 34,35, 38,39, 20,21, 28,29, 40,41,42,43,44,45, 46,47,48,49,50,51</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md163"></a>
Heatmap Saving in Float Format</h1>
<p>If you save the heatmaps in floating format by using the flag <code>--write_heatmaps_format float</code>, you can later read them in Python with: </p><div class="fragment"><div class="line"># Load custom float format - Example in Python, assuming a (18 x 300 x 500) size Array</div>
<div class="line">x = np.fromfile(heatMapFullPath, dtype=np.float32)</div>
<div class="line">assert x[0] == 3 # First parameter saves the number of dimensions (18x300x500 = 3 dimensions)</div>
<div class="line">shape_x = x[1:1+int(x[0])]</div>
<div class="line">assert len(shape_x[0]) == 3 # Number of dimensions</div>
<div class="line">assert shape_x[0] == 18 # Size of the first dimension</div>
<div class="line">assert shape_x[1] == 300 # Size of the second dimension</div>
<div class="line">assert shape_x[2] == 500 # Size of the third dimension</div>
<div class="line">arrayData = x[1+int(round(x[0])):]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md164"></a>
Heatmap Scaling</h1>
<p>Note that <code>--net_resolution</code> sets the size of the network, thus also the size of the output heatmaps. This heatmaps are resized while keeping the aspect ratio. When aspect ratio of the input and network are not the same, padding is added at the bottom and/or right part of the output heatmaps. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
